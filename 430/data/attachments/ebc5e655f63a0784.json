{
    "@timestamp": "2022-05-03T10:18:03.200Z",
    "agent": {
        "ephemeral_id": "ade702cc-58c4-47fe-8361-f8c21bcc2cf8",
        "id": "b263b051-1566-4269-a0de-074ad5e5d422",
        "name": "kind-mono-control-plane",
        "type": "cloudbeat",
        "version": "8.3.0"
    },
    "cloud": {
        "account": {},
        "instance": {
            "id": "f1a24a65-92a0-40c4-8d81-8c4c803d0aa8",
            "name": "SCUS-GHEUS21U20SCUSC24-0208"
        },
        "machine": {
            "type": "Standard_DS2_v2"
        },
        "provider": "azure",
        "region": "southcentralus",
        "service": {
            "name": "Virtual Machines"
        }
    },
    "cluster_id": "d40a39cd-8b4a-48ec-b755-382f7eb1514f",
    "cycle_id": "9e35b8fc-4605-4e22-8108-e055e493b6cc",
    "ecs": {
        "version": "8.0.0"
    },
    "host": {
        "architecture": "x86_64",
        "containerized": true,
        "hostname": "kind-mono-control-plane",
        "ip": [
            "10.244.0.1",
            "10.244.0.1",
            "10.244.0.1",
            "10.244.0.1",
            "172.18.0.2",
            "fc00:f853:ccd:e793::2",
            "fe80::42:acff:fe12:2"
        ],
        "mac": [
            "02:42:ac:12:00:02",
            "06:7b:45:e6:52:1b",
            "3e:ba:40:af:00:81",
            "ae:25:cc:7c:8d:de",
            "d6:d8:2f:b5:c1:76"
        ],
        "name": "kind-mono-control-plane",
        "os": {
            "codename": "bullseye",
            "family": "debian",
            "kernel": "5.13.0-1022-azure",
            "name": "Debian GNU/Linux",
            "platform": "debian",
            "type": "linux",
            "version": "11 (bullseye)"
        }
    },
    "resource": {
        "id": "d40a39cd-8b4a-48ec-b755-382f7eb1514f16110d62-8a53-447a-b965-c7a4765718bb718",
        "name": "kubelet",
        "raw": {
            "command": "/usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --container-runtime=remote --container-runtime-endpoint=unix:///run/containerd/containerd.sock --fail-swap-on=false --node-ip=172.18.0.2 --node-labels= --pod-infra-container-image=k8s.gcr.io/pause:3.4.1 --provider-id=kind://docker/kind-mono/kind-mono-control-plane --fail-swap-on=false --cgroup-root=/kubelet",
            "external_data": {
                "config": {
                    "apiVersion": "kubelet.config.k8s.io/v1beta1",
                    "authentication": {
                        "anonymous": {
                            "enabled": false
                        },
                        "webhook": {
                            "cacheTTL": "0s",
                            "enabled": true
                        },
                        "x509": {
                            "clientCAFile": "/etc/kubernetes/pki/ca.crt"
                        }
                    },
                    "authorization": {
                        "mode": "Webhook",
                        "webhook": {
                            "cacheAuthorizedTTL": "0s",
                            "cacheUnauthorizedTTL": "0s"
                        }
                    },
                    "cgroupDriver": "cgroupfs",
                    "clusterDNS": [
                        "10.96.0.10"
                    ],
                    "clusterDomain": "cluster.local",
                    "cpuManagerReconcilePeriod": "0s",
                    "evictionHard": {
                        "imagefs.available": "0%",
                        "nodefs.available": "0%",
                        "nodefs.inodesFree": "0%"
                    },
                    "evictionPressureTransitionPeriod": "0s",
                    "fileCheckFrequency": "0s",
                    "healthzBindAddress": "127.0.0.1",
                    "healthzPort": 10248,
                    "httpCheckFrequency": "0s",
                    "imageGCHighThresholdPercent": 100,
                    "imageMinimumGCAge": "0s",
                    "kind": "KubeletConfiguration",
                    "logging": {},
                    "nodeStatusReportFrequency": "0s",
                    "nodeStatusUpdateFrequency": "0s",
                    "rotateCertificates": true,
                    "runtimeRequestTimeout": "0s",
                    "shutdownGracePeriod": "0s",
                    "shutdownGracePeriodCriticalPods": "0s",
                    "staticPodPath": "/etc/kubernetes/manifests",
                    "streamingConnectionIdleTimeout": "0s",
                    "syncFrequency": "0s",
                    "volumeStatsAggPeriod": "0s"
                }
            },
            "pid": "718",
            "stat": {
                "EffectiveGID": "",
                "EffectiveUID": "",
                "Group": "718",
                "Name": "kubelet",
                "Nice": "0",
                "Parent": "1",
                "RealGID": "",
                "RealUID": "",
                "ResidentSize": "87748000",
                "SavedGID": "",
                "SavedUID": "",
                "StartTime": "12853",
                "State": "S",
                "SystemTime": "633",
                "Threads": "14",
                "TotalSize": "1889720000",
                "UserTime": "1099"
            }
        },
        "sub_type": "process",
        "type": "process"
    },
    "resource_id": "d40a39cd-8b4a-48ec-b755-382f7eb1514f16110d62-8a53-447a-b965-c7a4765718bb718",
    "result": {
        "evaluation": "failed",
        "evidence": {
            "process_args": {
                "--/usr/bin/kubelet": "",
                "--bootstrap-kubeconfig": "/etc/kubernetes/bootstrap-kubelet.conf",
                "--cgroup-root": "/kubelet",
                "--config": "/var/lib/kubelet/config.yaml",
                "--container-runtime": "remote",
                "--container-runtime-endpoint": "unix:///run/containerd/containerd.sock",
                "--fail-swap-on": "false",
                "--kubeconfig": "/etc/kubernetes/kubelet.conf",
                "--node-ip": "172.18.0.2",
                "--node-labels": "",
                "--pod-infra-container-image": "k8s.gcr.io/pause:3.4.1",
                "--provider-id": "kind://docker/kind-mono/kind-mono-control-plane"
            },
            "process_config": {
                "config": {
                    "apiVersion": "kubelet.config.k8s.io/v1beta1",
                    "authentication": {
                        "anonymous": {
                            "enabled": false
                        },
                        "webhook": {
                            "cacheTTL": "0s",
                            "enabled": true
                        },
                        "x509": {
                            "clientCAFile": "/etc/kubernetes/pki/ca.crt"
                        }
                    },
                    "authorization": {
                        "mode": "Webhook",
                        "webhook": {
                            "cacheAuthorizedTTL": "0s",
                            "cacheUnauthorizedTTL": "0s"
                        }
                    },
                    "cgroupDriver": "cgroupfs",
                    "clusterDNS": [
                        "10.96.0.10"
                    ],
                    "clusterDomain": "cluster.local",
                    "cpuManagerReconcilePeriod": "0s",
                    "evictionHard": {
                        "imagefs.available": "0%",
                        "nodefs.available": "0%",
                        "nodefs.inodesFree": "0%"
                    },
                    "evictionPressureTransitionPeriod": "0s",
                    "fileCheckFrequency": "0s",
                    "healthzBindAddress": "127.0.0.1",
                    "healthzPort": 10248,
                    "httpCheckFrequency": "0s",
                    "imageGCHighThresholdPercent": 100,
                    "imageMinimumGCAge": "0s",
                    "kind": "KubeletConfiguration",
                    "logging": {},
                    "nodeStatusReportFrequency": "0s",
                    "nodeStatusUpdateFrequency": "0s",
                    "rotateCertificates": true,
                    "runtimeRequestTimeout": "0s",
                    "shutdownGracePeriod": "0s",
                    "shutdownGracePeriodCriticalPods": "0s",
                    "staticPodPath": "/etc/kubernetes/manifests",
                    "streamingConnectionIdleTimeout": "0s",
                    "syncFrequency": "0s",
                    "volumeStatsAggPeriod": "0s"
                }
            }
        },
        "expected": null
    },
    "rule": {
        "audit": "Ignore this check if `serverTLSBootstrap` is `true` in the kubelet config file\nor if the `--rotate-server-certificates` parameter is set on kubelet\nRun the following command on each node:\n```\nps -ef | grep kubelet\n```\nVerify that `RotateKubeletServerCertificate` argument exists and is set to `true`.\n",
        "benchmark": {
            "name": "CIS Kubernetes V1.20",
            "version": "v1.0.0"
        },
        "default_value": "By default, kubelet server certificate rotation is disabled.\n",
        "description": "Enable kubelet server certificate rotation.\n",
        "id": "87c7fdfd-c1f8-5794-a089-36125435bf1e",
        "impact": "None\n",
        "name": "Verify that the RotateKubeletServerCertificate argument is set to true (Manual)",
        "profile_applicability": "* Level 1 - Worker Node\n",
        "rationale": "`RotateKubeletServerCertificate` causes the kubelet to both request a serving certificate after bootstrapping its client credentials and rotate the certificate as its existing credentials expire. This automated periodic rotation ensures that the there are no downtimes due to expired certificates and thus addressing availability in the CIA security triad. Note: This recommendation only applies if you let kubelets get their certificates from the API server. In case your kubelet certificates come from an outside authority/tool (e.g. Vault) then you need to take care of rotation yourself.\n",
        "references": "1. [https://github.com/kubernetes/kubernetes/pull/45059](https://github.com/kubernetes/kubernetes/pull/45059)\n2. [https://kubernetes.io/docs/admin/kubelet-tls-bootstrapping/#kubelet-configuration](https://kubernetes.io/docs/admin/kubelet-tls-bootstrapping/#kubelet-configuration)\n",
        "remediation": "Edit the kubelet service file\n`/etc/systemd/system/kubelet.service.d/10-kubeadm.conf`\non each worker node and set the below parameter in `KUBELET_CERTIFICATE_ARGS` variable.\n```\n--feature-gates=RotateKubeletServerCertificate=true\n```\nBased on your system, restart the kubelet service. For example:\n```\nsystemctl daemon-reload\n\nsystemctl restart kubelet.service\n```\n",
        "section": "Kubelet",
        "tags": [
            "CIS",
            "Kubernetes",
            "CIS 4.2.12",
            "Kubelet"
        ],
        "version": "1.0"
    },
    "type": "process"
}